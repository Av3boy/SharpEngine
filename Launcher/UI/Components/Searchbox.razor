<div class="searchbox @CssClass">
    <button type="submit" class="searchbox-btn"><Icon IconType="SvgIcon.Lens" /></button>
    <input type="text" class="searchbox-input" placeholder="Search.." name="search" value="@Value" @onchange="@OnChangeAsync">
</div>

@code {
    /// <summary>Gets or sets the value of the search box.</summary>
    [Parameter]
    public string Value { get; set; } = default!;

    /// <summary>Gets or sets the event executed when the value of the search box changes.</summary>
    [Parameter]
    public EventCallback<string> ValueChanged { get; set; }

    /// <summary>Gets or sets the delay in milliseconds before the value is updated after the user stops typing.</summary>
    [Parameter]
    public int DebounceDelayMilliseconds { get; set; } = 1000;

    /// <summary>Gets or sets any extra CSS classes to apply to the search box.</summary>
    [Parameter]
    public string? CssClass { get; set; }

    private CancellationTokenSource _tokenSource { get; set; } = new();

    private async Task OnChangeAsync(ChangeEventArgs e)
    {
        _tokenSource = new CancellationTokenSource();
        var token = _tokenSource.Token;

        await Task.Delay(DebounceDelayMilliseconds, token);

        Value = e.Value?.ToString() ?? string.Empty;
        await ValueChanged.InvokeAsync(Value);
    }
}
